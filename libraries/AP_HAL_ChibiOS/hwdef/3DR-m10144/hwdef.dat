# hw definition file for processing by chibios_pins.py

# MCU class and specific type
MCU STM32G474 STM32G474xx

# bootloader starts firmware at 26kB (24k bootloader + 2k (STORAGE_FLASH_PAGES))
FLASH_RESERVE_START_KB 40

FLASH_SIZE_KB 512

# parameter storage
STORAGE_FLASH_PAGE 16
define HAL_STORAGE_SIZE 2000

# board ID for firmware load
APJ_BOARD_ID 1122

# setup build for a peripheral firmware
env AP_PERIPH 1

# crystal frequency
OSCILLATOR_HZ 24000000
define STM32_HSE_BYPASS

# enable external tcxo
PA4 TCXO_EN OUTPUT HIGH

# serial
define HAL_NO_UARTDRIVER
define HAL_USE_SERIAL FALSE

# LED
PC13 LED_ACTIVITY OUTPUT HIGH
define HAL_LED_ON 1

# No analog input
define HAL_USE_ADC FALSE
define STM32_ADC_USE_ADC1 FALSE
define HAL_DISABLE_ADC_DRIVER FALSE

# MAIN_STACK is stack of initial thread and ISRs
#MAIN_STACK 0x200

# PROCESS_STACK controls stack for main thread
#PROCESS_STACK 0xA00
define HAL_DISABLE_LOOP_DELAY

# enable CAN support
PA11 CAN1_RX CAN1
PA12 CAN1_TX CAN1

define HAL_NO_GPIO_IRQ
define HAL_USE_EMPTY_IO TRUE
define PORT_INT_REQUIRED_STACK 64


define HAL_NO_MONITOR_THREAD

define DMA_RESERVE_SIZE 0

define HAL_DISABLE_LOOP_DELAY

define HAL_DEVICE_THREAD_STACK 256

define AP_PARAM_MAX_EMBEDDED_PARAM 0

# SPI
PC15 MAG_CS CS

# spi bus for compass
PB3 SPI3_SCK SPI3
PB4 SPI3_MISO SPI3
PB5 SPI3_MOSI SPI3

# debugger support
PA13 JTMS-SWDIO SWD
PA14 JTCK-SWCLK SWD

# bootloader embedding / bootloader flashing not available
define AP_BOOTLOADER_FLASHING_ENABLED 0

# keep ROMFS uncompressed as we don't have enough RAM
# to uncompress the bootloader at runtime
env ROMFS_UNCOMPRESSED True

define CAN_APP_NODE_NAME "com.3dr.m10144"

# MAG
define AP_RM3100_REVERSAL_MASK 2
SPIDEV rm3100 SPI3 DEVID1 MAG_CS MODE0 1*MHZ 1*MHZ
COMPASS RM3100 SPI:rm3100 false ROTATION_NONE

# AP_Periph
define HAL_PERIPH_ENABLE_MAG
